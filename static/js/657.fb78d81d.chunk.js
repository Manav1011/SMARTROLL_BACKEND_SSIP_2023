"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[657],{6657:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var l=a(2791),r=a(6912),t=a(2937),n=(a(2673),a(9792)),c=a(5294),d=a(2958),i=a(2585),o=a(7689),g=a(184);const m=()=>{const e=new URL(window.location.href.replace("/#","")),[s]=(0,l.useState)(e.searchParams.get("slug")),[a,m]=(0,l.useState)(null),[u,h]=(0,l.useState)(null),{state:x,dispatch:b}=(0,l.useContext)(i.y),{accessToken:j}=x,p=(0,l.useRef)(null),[y,w]=(0,l.useState)(!1),f=(0,l.useRef)(null),v=(0,o.s0)(),[N,k]=(0,n.Z)();(0,l.useEffect)((()=>{if(navigator.geolocation){function e(e){console.log("Latitude:",e.coords.latitude),console.log("Longitude:",e.coords.longitude)}function a(e){console.error("Error getting location:",e.message)}for(let l=0;l<5;l++)navigator.geolocation.getCurrentPosition(e,a,{enableHighAccuracy:!0,maximumAge:0})}else console.error("Geolocation is not supported by this browser.");if(s){const r={"Content-Type":"application/json","ngrok-skip-browser-warning":!0},t=c.Z.create();k(N,t,"/manage/session/create_lecture_session/","post",r,{lecture_slug:s},null).then((e=>{if(!1===e.error){const s=e.response;"post"==s.data.data.active&&(alert("The session has already been ended!!"),v("/teacher/dashboard")),f.current||(f.current=new WebSocket("".concat(d.I,"/ws/attendance_session/").concat(s.data.data.session_id,"/?").concat(j))),h(s.data.data.marked_attendances),m(s.data.data)}else alert(e.errorMessage.message),v("/teacher/dashboard")}))}}),[s]),(0,l.useEffect)((()=>{f.current&&(f.current.onopen=()=>{console.log("WebSocket connection established")},f.current.onclose=()=>{console.log("WebSocket connection closed")},f.current.onmessage=e=>{let s=JSON.parse(e.data);console.log(s),s.message&&("attendance_marked"==s.message.action?h((e=>[...e,s.message.data])):"session_ended"==s.message.action?(h(s.message.data.marked_attendances),alert("Session has ended"),w(!0)):"session_already_ended"==s.message.action&&alert("Session has already been ended"))},f.current.onerror=e=>{console.error("WebSocket error:",e)})}),[f.current]);return(0,g.jsx)(g.Fragment,{children:a?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(t.rb,{children:(0,g.jsx)(t.b7,{children:(0,g.jsxs)(t.xH,{className:"card",children:[(0,g.jsx)(t.bn,{children:(0,g.jsxs)("div",{className:"d-flex justify-content-sm-between justify-content-center flex-wrap",children:[(0,g.jsx)("div",{className:"mx-3 mb-2",children:(0,g.jsx)("strong",{children:"Lecture Details"})}),(0,g.jsx)("div",{className:"mx-3",children:(0,g.jsx)("strong",{children:new Date(a.created_at).toLocaleString()})})]})}),(0,g.jsx)(t.sl,{children:(0,g.jsx)("div",{className:"d-flex flex-wrap w-100",children:(0,g.jsx)("div",{className:"col-12",children:(0,g.jsxs)("div",{className:"w-100 d-flex flex-wrap flex-1 justify-center",children:[(0,g.jsx)("div",{className:"text-center col-12 col-sm-3 col-md-3 col-lg-3",children:(0,g.jsxs)("p",{style:{margin:"0px",padding:"0px"},children:[a.lecture.start_time," | ",a.lecture.end_time]})}),(0,g.jsx)("div",{className:"text-center col-12 col-sm-3 col-md-3 col-lg-3",children:(0,g.jsx)("p",{style:{margin:"0px",padding:"0px"},children:a.lecture.subject.subject_name})}),(0,g.jsx)("div",{className:"text-center col-12 col-sm-3 col-md-3 col-lg-3",children:(0,g.jsx)("p",{style:{margin:"0px",padding:"0px"},children:a.lecture.type})}),(0,g.jsx)("div",{className:"text-center col-12 col-sm-3 col-md-3 col-lg-3",children:(0,g.jsx)("p",{style:{margin:"0px",padding:"0px"},children:a.lecture.classroom.class_name})})]})})})})]})})}),(0,g.jsx)(t.rb,{className:"mt-3",children:(0,g.jsx)(t.b7,{xs:!0,children:(0,g.jsxs)(t.xH,{className:"mb-4",children:[(0,g.jsx)(t.bn,{className:"",children:y?(0,g.jsx)(r.DownloadTableExcel,{filename:"".concat(a.lecture.subject.subject_name," - ").concat(new Date(a.lecture.session.day).toLocaleString()),sheet:"users",currentTableRef:p.current,children:(0,g.jsx)("button",{className:"my-2 w-100 btn btn btn-outline-primary",children:" Export excel "})}):(0,g.jsxs)("div",{className:"my-2 w-100 btn btn btn-outline-danger",onClick:()=>{f.current&&f.current.send(JSON.stringify({action:"end_session"}))},children:[(0,g.jsx)("span",{className:"me-3 d-inline",children:"End Session"}),(0,g.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"d-inline bi bi-stop-circle-fill",viewBox:"0 0 16 16",children:(0,g.jsx)("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.5 5A1.5 1.5 0 0 0 5 6.5v3A1.5 1.5 0 0 0 6.5 11h3A1.5 1.5 0 0 0 11 9.5v-3A1.5 1.5 0 0 0 9.5 5z"})})]})}),(0,g.jsx)(t.sl,{children:(0,g.jsx)(t.rb,{className:"w-100 flex-col",children:(0,g.jsx)(t.b7,{className:"col-12",children:(0,g.jsx)("div",{className:"table-responsive",children:(0,g.jsxs)("table",{align:"middle",className:"table align-middle table-hover text-center mb-0 border hover responsive",ref:p,children:[(0,g.jsxs)(t.V,{color:"light",children:[(0,g.jsx)(t.T6,{"aria-colspan":5,children:(0,g.jsx)(t.is,{colSpan:5,children:"L.D COLLEGE OF ENGINEERING"})}),(0,g.jsx)(t.T6,{"aria-colspan":5,children:(0,g.jsxs)(t.is,{colSpan:5,children:["Subject: ",a.lecture.subject.subject_name," | DATE: ",a.lecture.session.day]})}),(0,g.jsxs)(t.T6,{children:[(0,g.jsx)(t.is,{children:"Enrollment No"}),(0,g.jsx)(t.is,{children:"Student Name"}),(0,g.jsx)(t.is,{children:"Batch"}),(0,g.jsx)(t.is,{children:"Status"})]})]}),(0,g.jsx)(t.NR,{children:u&&u.map(((e,s)=>(0,g.jsxs)(t.T6,{"v-for":"alert alert-primary item in tableItems",children:[(0,g.jsx)(t.NN,{children:(0,g.jsx)("div",{children:e.student.enrollment?e.student.enrollment:"-"})}),(0,g.jsx)(t.NN,{children:(0,g.jsx)("div",{children:e.student.profile.name?e.student.profile.name:"-"})}),(0,g.jsx)(t.NN,{children:(0,g.jsx)("div",{children:e.batches?e.batches.map(((e,s)=>(0,g.jsx)("span",{children:e.batch_name.toUpperCase()},s))):"-"})}),e.is_present?(0,g.jsx)(t.NN,{children:(0,g.jsxs)("div",{className:"text-success d-flex justify-content-center align-items-center",children:[(0,g.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"mx-auto bi bi-patch-check",viewBox:"0 0 16 16",children:[(0,g.jsx)("path",{fillRule:"evenodd",d:"M10.354 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708 0"}),(0,g.jsx)("path",{d:"m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911z"})]}),(0,g.jsx)("p",{style:{visibility:"hidden"},children:"P"})]})}):(0,g.jsx)(t.NN,{children:(0,g.jsxs)("div",{className:"text-success d-flex justify-content-center align-items-center",children:[(0,g.jsx)("input",{type:"checkbox",onClick:s=>{(async(e,s)=>{e.preventDefault();try{if(!confirm("Are you sure you want to mark the attendance manually?"))return;console.log(s),e.target.checked="checked",e.target.disabled=!0;const t=c.Z.create(),n={"Content-Type":"application/json","ngrok-skip-browser-warning":!0},d={attendance_slug:s},i=await k(N,t,"/manage/session/mark_attendance_for_absent_student/","post",n,d,null);if(!1===i.error){i.response;const s=e.target.parentElement,t=s.children;t[1].innerText="P",s.removeChild(t[0]);var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("width","16"),a.setAttribute("height","16"),a.setAttribute("fill","currentColor"),a.setAttribute("class","mx-auto bi bi-patch-check"),a.setAttribute("viewBox","0 0 16 16");var l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("fill-rule","evenodd"),l.setAttribute("d","M10.354 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708 0");var r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911z"),a.appendChild(l),a.appendChild(r),s.prepend(a)}else alert(i.errorMessage.message)}catch(t){alert(t.message)}})(s,e.slug)}}),(0,g.jsx)("p",{style:{visibility:"hidden"},children:"F"})]})})]},s)))})]})})})})})]})})})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{role:"status",className:"p-4 border border-gray-200 rounded shadow animate-pulse md:p-6 dark:border-gray-700",children:[(0,g.jsx)("div",{className:"h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-32 mb-2.5"}),(0,g.jsx)("div",{className:"w-48 h-2 mb-10 bg-gray-200 rounded-full dark:bg-gray-700"}),(0,g.jsxs)("div",{className:"flex items-baseline mt-4",children:[(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-72 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full h-56 ms-6 bg-gray-200 rounded-t-lg dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-72 ms-6 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full h-64 ms-6 bg-gray-200 rounded-t-lg dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-80 ms-6 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-72 ms-6 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-80 ms-6 dark:bg-gray-300"})]}),(0,g.jsx)("span",{className:"sr-only",children:"Loading..."})]}),(0,g.jsxs)("div",{role:"status",className:"p-4 border border-gray-200 rounded shadow animate-pulse md:p-6 dark:border-gray-700",children:[(0,g.jsx)("div",{className:"h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-32 mb-2.5"}),(0,g.jsx)("div",{className:"w-48 h-2 mb-10 bg-gray-200 rounded-full dark:bg-gray-700"}),(0,g.jsxs)("div",{className:"flex items-baseline mt-4",children:[(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-72 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full h-56 ms-6 bg-gray-200 rounded-t-lg dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-72 ms-6 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full h-64 ms-6 bg-gray-200 rounded-t-lg dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-80 ms-6 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-72 ms-6 dark:bg-gray-300"}),(0,g.jsx)("div",{className:"w-full bg-gray-200 rounded-t-lg h-80 ms-6 dark:bg-gray-300"})]}),(0,g.jsx)("span",{className:"sr-only",children:"Loading..."})]})]})})}}}]);
//# sourceMappingURL=657.fb78d81d.chunk.js.map